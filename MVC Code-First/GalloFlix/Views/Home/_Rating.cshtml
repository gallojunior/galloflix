@model GalloFlix.Models.Movie
@using System.Security.Claims
@using Microsoft.AspNetCore.Identity
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager
@{
    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    if (userId != string.Empty)
    {
        var userRate = Model.Ratings.Where(r => r.UserId == userId);
    }
}

<div class="mt-5 text-center">
    @if (Model.Ratings.Count == 0)
    {
        <p class="fs-5 text-center text-primary">
            Este filme ainda não foi avaliado. Seja o primeiro!!!
        </p>
    }
    
    @if (SignInManager.IsSignedIn(User))
    {
        <p class="fs-5">Sua avaliação: <span class="fs-3" id="spanRate">
                @Model.Ratings.Where(r => r.UserId == userId).Select(r => r.RatingValue).FirstOrDefault()
            </span></p>
        <form asp-action="Rate" method="post">
            <input type="hidden" asp-for="Id">
            <div class="rating">
                <input type="radio" name="rating" value="10" id="10"><label for="10">☆</label>
                <input type="radio" name="rating" value="9" id="9"><label for="9">☆</label>
                <input type="radio" name="rating" value="8" id="8"><label for="8">☆</label>
                <input type="radio" name="rating" value="7" id="7"><label for="7">☆</label>
                <input type="radio" name="rating" value="6" id="6"><label for="6">☆</label>
                <input type="radio" name="rating" value="5" id="5"><label for="5">☆</label>
                <input type="radio" name="rating" value="4" id="4"><label for="4">☆</label>
                <input type="radio" name="rating" value="3" id="3"><label for="3">☆</label>
                <input type="radio" name="rating" value="2" id="2"><label for="2">☆</label>
                <input type="radio" name="rating" value="1" id="1"><label for="1">☆</label>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Avaliar</button>
        </form>
    }
    else
    {
        <p class="mb-2">Já possui uma conta!
            <a class="text-primary" asp-area="Identity" asp-page="/Account/Login"
            asp-route-returnUrl="@Url.Action("Detail", "Home", new { area = "", id = Model.Id })">
                Faça Login e avalie este filme!
            </a>
        </p>
        <p class="mb-2">ou</p>
        <p> Crie sua conta
            <a class="text-primary" asp-area="Identity" asp-page="/Account/Register"
            asp-route-returnUrl="@Url.Action("Detail", "Home", new { area = "", id = Model.Id })">
                clicando aqui
            </a>
            para ter mais acesso a nosso site!
        </p>
    }


</div>
